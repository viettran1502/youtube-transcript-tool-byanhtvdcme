<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Transcript Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .loading-spinner {
            border: 3px solid #f3f3f4;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-white mb-2">
                <i class="fab fa-youtube text-red-500"></i>
                YouTube Transcript Tool
            </h1>
            <p class="text-white opacity-80">Chuyển đổi video YouTube sang text một cách dễ dàng</p>
        </div>

        <!-- Main Card -->
        <div class="max-w-4xl mx-auto glass-card rounded-2xl p-8 shadow-2xl">
            <!-- Input Section -->
            <div class="mb-8">
                <label class="block text-white text-lg font-semibold mb-3">
                    <i class="fas fa-link mr-2"></i>
                    URL YouTube hoặc Video ID:
                </label>
                <div class="flex gap-3">
                    <input 
                        type="text" 
                        id="urlInput" 
                        placeholder="https://www.youtube.com/watch?v=... hoặc ABC123"
                        class="flex-1 px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"
                    >
                    <button 
                        id="processBtn"
                        class="px-8 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold transition-colors duration-200 flex items-center gap-2"
                    >
                        <i class="fas fa-play"></i>
                        Xử lý
                    </button>
                </div>
            </div>

            <!-- Options -->
            <div class="grid md:grid-cols-2 gap-6 mb-8">
                <div>
                    <label class="block text-white text-sm font-semibold mb-2">
                        <i class="fas fa-language mr-2"></i>
                        Ngôn ngữ ưu tiên:
                    </label>
                    <select id="languageSelect" class="w-full px-3 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="vi,en">Tiếng Việt, English</option>
                        <option value="en">English</option>
                        <option value="vi">Tiếng Việt</option>
                        <option value="ja">日本語</option>
                        <option value="ko">한국어</option>
                        <option value="zh">中文</option>
                    </select>
                </div>
                <div>
                    <label class="block text-white text-sm font-semibold mb-2">
                        <i class="fas fa-clock mr-2"></i>
                        Tùy chọn:
                    </label>
                    <div class="flex items-center space-x-4">
                        <label class="flex items-center text-white">
                            <input type="checkbox" id="includeTimestamps" class="mr-2">
                            Bao gồm timestamps
                        </label>
                    </div>
                </div>
            </div>

            <!-- Status Display -->
            <div id="statusSection" class="hidden mb-6">
                <div class="bg-white bg-opacity-20 rounded-lg p-4">
                    <div id="statusContent" class="text-white"></div>
                </div>
            </div>

            <!-- Results Section -->
            <div id="resultsSection" class="hidden fade-in">
                <!-- Video Info -->
                <div id="videoInfo" class="mb-6 p-4 bg-white bg-opacity-10 rounded-lg">
                    <h3 class="text-white font-semibold mb-2">
                        <i class="fas fa-info-circle mr-2"></i>
                        Thông tin video:
                    </h3>
                    <div id="videoDetails" class="text-white opacity-90"></div>
                </div>

                <!-- Available Languages -->
                <div id="languagesSection" class="mb-6 p-4 bg-white bg-opacity-10 rounded-lg hidden">
                    <h3 class="text-white font-semibold mb-2">
                        <i class="fas fa-globe mr-2"></i>
                        Ngôn ngữ có sẵn:
                    </h3>
                    <div id="languagesList" class="text-white opacity-90"></div>
                </div>

                <!-- Transcript Output -->
                <div class="mb-6">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-white font-semibold">
                            <i class="fas fa-file-text mr-2"></i>
                            Transcript:
                        </h3>
                        <div class="flex gap-2">
                            <button id="copyBtn" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm transition-colors">
                                <i class="fas fa-copy mr-1"></i>
                                Copy
                            </button>
                            <button id="downloadBtn" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg text-sm transition-colors">
                                <i class="fas fa-download mr-1"></i>
                                Tải xuống
                            </button>
                        </div>
                    </div>
                    <textarea 
                        id="transcriptOutput" 
                        class="w-full h-80 px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-vertical"
                        placeholder="Transcript sẽ hiển thị ở đây..."
                        readonly
                    ></textarea>
                </div>

                <!-- Statistics -->
                <div id="statsSection" class="grid md:grid-cols-3 gap-4">
                    <div class="bg-white bg-opacity-10 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-white" id="wordCount">0</div>
                        <div class="text-white opacity-80">Số từ</div>
                    </div>
                    <div class="bg-white bg-opacity-10 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-white" id="charCount">0</div>
                        <div class="text-white opacity-80">Ký tự</div>
                    </div>
                    <div class="bg-white bg-opacity-10 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-white" id="duration">0:00</div>
                        <div class="text-white opacity-80">Thời lượng</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="text-center mt-8 text-white opacity-60">
            <p>
                <i class="fas fa-heart text-red-400"></i>
                Made with love | Hỗ trợ tất cả video YouTube có subtitle
            </p>
        </div>
    </div>

    <script>
        class YouTubeTranscriptApp {
            constructor() {
                this.currentTranscript = null;
                this.currentVideoId = null;
                this.initializeEventListeners();
            }

            initializeEventListeners() {
                document.getElementById('processBtn').addEventListener('click', () => this.processVideo());
                document.getElementById('urlInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.processVideo();
                });
                document.getElementById('copyBtn').addEventListener('click', () => this.copyTranscript());
                document.getElementById('downloadBtn').addEventListener('click', () => this.downloadTranscript());
            }

            extractVideoId(url) {
                const patterns = [
                    /(?:https?:\/\/)?(?:www\.)?youtube\.com\/watch\?v=([a-zA-Z0-9_-]+)/,
                    /(?:https?:\/\/)?(?:www\.)?youtu\.be\/([a-zA-Z0-9_-]+)/,
                    /(?:https?:\/\/)?(?:www\.)?youtube\.com\/embed\/([a-zA-Z0-9_-]+)/
                ];

                for (const pattern of patterns) {
                    const match = url.match(pattern);
                    if (match) return match[1];
                }

                if (/^[a-zA-Z0-9_-]{11}$/.test(url)) {
                    return url;
                }

                return null;
            }

            showStatus(message, type = 'info') {
                const statusSection = document.getElementById('statusSection');
                const statusContent = document.getElementById('statusContent');
                
                let icon = '';
                let bgColor = '';
                
                switch(type) {
                    case 'loading':
                        icon = '<div class="loading-spinner inline-block mr-2"></div>';
                        bgColor = 'bg-blue-500';
                        break;
                    case 'success':
                        icon = '<i class="fas fa-check-circle mr-2"></i>';
                        bgColor = 'bg-green-500';
                        break;
                    case 'error':
                        icon = '<i class="fas fa-exclamation-triangle mr-2"></i>';
                        bgColor = 'bg-red-500';
                        break;
                    default:
                        icon = '<i class="fas fa-info-circle mr-2"></i>';
                        bgColor = 'bg-blue-500';
                }

                statusContent.innerHTML = `${icon}${message}`;
                statusSection.className = `mb-6 p-4 ${bgColor} bg-opacity-20 rounded-lg`;
                statusSection.classList.remove('hidden');
            }

            hideStatus() {
                document.getElementById('statusSection').classList.add('hidden');
            }

            async processVideo() {
                const urlInput = document.getElementById('urlInput').value.trim();
                const languageSelect = document.getElementById('languageSelect').value;
                const includeTimestamps = document.getElementById('includeTimestamps').checked;

                if (!urlInput) {
                    this.showStatus('Vui lòng nhập URL YouTube hoặc Video ID', 'error');
                    return;
                }

                const videoId = this.extractVideoId(urlInput);
                if (!videoId) {
                    this.showStatus('URL không hợp lệ. Vui lòng kiểm tra lại.', 'error');
                    return;
                }

                this.currentVideoId = videoId;
                document.getElementById('resultsSection').classList.add('hidden');

                try {
                    this.showStatus('Đang xử lý video...', 'loading');

                    const response = await fetch('/api/transcript', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            url: urlInput,
                            languages: languageSelect.split(','),
                            include_timestamps: includeTimestamps
                        })
                    });

                    const result = await response.json();

                    if (result.success) {
                        this.currentTranscript = result;
                        this.displayResults(result);
                        this.showStatus('Xử lý thành công!', 'success');
                        setTimeout(() => this.hideStatus(), 3000);
                    } else {
                        this.showStatus(result.message || 'Có lỗi xảy ra', 'error');
                    }

                } catch (error) {
                    this.showStatus('Lỗi kết nối. Vui lòng thử lại sau.', 'error');
                    console.error('Error:', error);
                }
            }

            displayResults(result) {
                document.getElementById('videoDetails').innerHTML = `
                    <div class="grid md:grid-cols-2 gap-4">
                        <div><strong>Video ID:</strong> ${this.currentVideoId}</div>
                        <div><strong>Ngôn ngữ:</strong> ${result.language}</div>
                    </div>
                `;

                if (result.available_languages) {
                    const languagesList = result.available_languages.map(lang => 
                        `<span class="inline-block bg-white bg-opacity-20 px-2 py-1 rounded mr-2 mb-1">
                            ${lang.language} (${lang.language_code}) ${lang.is_generated ? '- Tự động' : '- Thủ công'}
                        </span>`
                    ).join('');
                    
                    document.getElementById('languagesList').innerHTML = languagesList;
                    document.getElementById('languagesSection').classList.remove('hidden');
                }

                document.getElementById('transcriptOutput').value = result.text;

                document.getElementById('wordCount').textContent = result.word_count || 0;
                document.getElementById('charCount').textContent = result.text.length || 0;
                document.getElementById('duration').textContent = this.formatDuration(result.duration || 0);

                document.getElementById('resultsSection').classList.remove('hidden');
            }

            formatDuration(seconds) {
                const hours = Math.floor(seconds / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                const secs = Math.floor(seconds % 60);

                if (hours > 0) {
                    return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                }
                return `${minutes}:${secs.toString().padStart(2, '0')}`;
            }

            async copyTranscript() {
                const transcript = document.getElementById('transcriptOutput').value;
                if (!transcript) return;

                try {
                    await navigator.clipboard.writeText(transcript);
                    
                    const btn = document.getElementById('copyBtn');
                    const originalText = btn.innerHTML;
                    btn.innerHTML = '<i class="fas fa-check mr-1"></i>Đã copy!';
                    btn.classList.remove('bg-green-600', 'hover:bg-green-700');
                    btn.classList.add('bg-green-800');
                    
                    setTimeout(() => {
                        btn.innerHTML = originalText;
                        btn.classList.remove('bg-green-800');
                        btn.classList.add('bg-green-600', 'hover:bg-green-700');
                    }, 2000);
                } catch (error) {
                    console.error('Copy failed:', error);
                }
            }

            downloadTranscript() {
                const transcript = document.getElementById('transcriptOutput').value;
                if (!transcript) return;

                const includeTimestamps = document.getElementById('includeTimestamps').checked;
                let content = transcript;
                let filename = `transcript_${this.currentVideoId}.txt`;

                if (includeTimestamps && this.currentTranscript.transcript) {
                    content = this.generateSRT(this.currentTranscript.transcript);
                    filename = `transcript_${this.currentVideoId}.srt`;
                }

                const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
            }

            generateSRT(transcript) {
                return transcript.map((item, index) => {
                    const startTime = this.secondsToSRTTime(item.start);
                    const endTime = this.secondsToSRTTime(item.start + item.duration);
                    
                    return `${index + 1}\n${startTime} --> ${endTime}\n${item.text}\n`;
                }).join('\n');
            }

            secondsToSRTTime(seconds) {
                const hours = Math.floor(seconds / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                const secs = Math.floor(seconds % 60);
                const millisecs = Math.floor((seconds % 1) * 1000);
                
                return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')},${millisecs.toString().padStart(3, '0')}`;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            new YouTubeTranscriptApp();
        });
    </script>
</body>
</html>