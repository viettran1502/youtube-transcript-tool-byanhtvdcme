<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Platform Video Transcript Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .loading-spinner {
            border: 3px solid #f3f3f4;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .platform-button {
            transition: all 0.3s ease;
            transform: scale(1);
        }
        .platform-button:hover {
            transform: scale(1.02);
        }
        .platform-button.active {
            background: rgba(59, 130, 246, 0.3);
            border-color: rgba(59, 130, 246, 0.6);
            transform: scale(1.02);
        }
        .platform-icon {
            font-size: 1.5rem;
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-white mb-2">
                <i class="fas fa-video text-blue-400"></i>
                Multi-Platform Video Transcript Tool
            </h1>
            <p class="text-white opacity-80">Chuyển đổi video từ YouTube, TikTok, X (Twitter) sang text một cách dễ dàng</p>
        </div>

        <!-- Main Card -->
        <div class="max-w-4xl mx-auto glass-card rounded-2xl p-8 shadow-2xl">
            <!-- Platform Selection -->
            <div class="mb-8">
                <label class="block text-white text-lg font-semibold mb-4">
                    <i class="fas fa-globe mr-2"></i>
                    Chọn nền tảng:
                </label>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3" id="platformSelector">
                    <button class="platform-button glass-card p-4 rounded-lg text-white text-center hover:bg-opacity-20 transition-all duration-300" 
                            data-platform="auto" onclick="selectPlatform('auto')">
                        <i class="fas fa-magic platform-icon text-purple-400 mb-2 block"></i>
                        <div class="font-semibold">Tự động</div>
                        <div class="text-xs opacity-80">Phát hiện tự động</div>
                    </button>
                    <button class="platform-button glass-card p-4 rounded-lg text-white text-center hover:bg-opacity-20 transition-all duration-300" 
                            data-platform="youtube" onclick="selectPlatform('youtube')">
                        <i class="fab fa-youtube platform-icon text-red-500 mb-2 block"></i>
                        <div class="font-semibold">YouTube</div>
                        <div class="text-xs opacity-80">Videos & Shorts</div>
                    </button>
                    <button class="platform-button glass-card p-4 rounded-lg text-white text-center hover:bg-opacity-20 transition-all duration-300" 
                            data-platform="tiktok" onclick="selectPlatform('tiktok')">
                        <i class="fab fa-tiktok platform-icon text-pink-400 mb-2 block"></i>
                        <div class="font-semibold">TikTok</div>
                        <div class="text-xs opacity-80">TikTok videos</div>
                    </button>
                    <button class="platform-button glass-card p-4 rounded-lg text-white text-center hover:bg-opacity-20 transition-all duration-300" 
                            data-platform="twitter" onclick="selectPlatform('twitter')">
                        <i class="fab fa-x-twitter platform-icon text-blue-400 mb-2 block"></i>
                        <div class="font-semibold">X (Twitter)</div>
                        <div class="text-xs opacity-80">Video posts</div>
                    </button>
                </div>
            </div>

            <!-- Input Section -->
            <div class="mb-8">
                <label class="block text-white text-lg font-semibold mb-3">
                    <i class="fas fa-link mr-2"></i>
                    <span id="urlLabel">URL Video hoặc Video ID:</span>
                </label>
                <div class="flex gap-3">
                    <input 
                        type="text" 
                        id="urlInput" 
                        placeholder="Nhập URL video từ YouTube, TikTok, X hoặc Video ID..."
                        class="flex-1 px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"
                    >
                    <button 
                        id="processBtn"
                        class="px-8 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold transition-colors duration-200 flex items-center gap-2"
                    >
                        <i class="fas fa-play"></i>
                        Xử lý
                    </button>
                </div>
                
                <!-- Platform Examples -->
                <div class="mt-3">
                    <div class="text-white text-sm opacity-70">
                        <strong>Ví dụ:</strong>
                        <div id="platformExamples" class="mt-1">
                            <div>• YouTube: https://www.youtube.com/watch?v=dQw4w9WgXcQ</div>
                            <div>• TikTok: https://www.tiktok.com/@username/video/1234567890</div>
                            <div>• X: https://twitter.com/username/status/1234567890</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Options -->
            <div class="grid md:grid-cols-2 gap-6 mb-8">
                <div>
                    <label class="block text-white text-sm font-semibold mb-2">
                        <i class="fas fa-language mr-2"></i>
                        Ngôn ngữ ưu tiên:
                    </label>
                    <select id="languageSelect" class="w-full px-3 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="vi,en">Tiếng Việt, English</option>
                        <option value="en">English</option>
                        <option value="vi">Tiếng Việt</option>
                        <option value="ja">日本語</option>
                        <option value="ko">한국어</option>
                        <option value="zh">中文</option>
                        <option value="es">Español</option>
                        <option value="de">Deutsch</option>
                    </select>
                </div>
                <div>
                    <label class="block text-white text-sm font-semibold mb-2">
                        <i class="fas fa-clock mr-2"></i>
                        Tùy chọn:
                    </label>
                    <div class="flex items-center space-x-4">
                        <label class="flex items-center text-white">
                            <input type="checkbox" id="includeTimestamps" class="mr-2">
                            Bao gồm timestamps
                        </label>
                    </div>
                </div>
            </div>

            <!-- Status Display -->
            <div id="statusSection" class="hidden mb-6">
                <div class="bg-white bg-opacity-20 rounded-lg p-4">
                    <div id="statusContent" class="text-white"></div>
                </div>
            </div>

            <!-- Results Section -->
            <div id="resultsSection" class="hidden fade-in">
                <!-- Video Info -->
                <div id="videoInfo" class="mb-6 p-4 bg-white bg-opacity-10 rounded-lg">
                    <h3 class="text-white font-semibold mb-2">
                        <i class="fas fa-info-circle mr-2"></i>
                        Thông tin video:
                    </h3>
                    <div id="videoDetails" class="text-white opacity-90"></div>
                </div>

                <!-- Available Languages -->
                <div id="languagesSection" class="mb-6 p-4 bg-white bg-opacity-10 rounded-lg hidden">
                    <h3 class="text-white font-semibold mb-2">
                        <i class="fas fa-globe mr-2"></i>
                        Ngôn ngữ có sẵn:
                    </h3>
                    <div id="languagesList" class="text-white opacity-90"></div>
                </div>

                <!-- Transcript Output -->
                <div class="mb-6">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-white font-semibold">
                            <i class="fas fa-file-text mr-2"></i>
                            Transcript:
                        </h3>
                        <div class="flex gap-2">
                            <button id="copyBtn" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm transition-colors">
                                <i class="fas fa-copy mr-1"></i>
                                Copy
                            </button>
                            <button id="downloadBtn" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg text-sm transition-colors">
                                <i class="fas fa-download mr-1"></i>
                                Tải xuống
                            </button>
                        </div>
                    </div>
                    <textarea 
                        id="transcriptOutput" 
                        class="w-full h-80 px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-vertical"
                        placeholder="Transcript sẽ hiển thị ở đây..."
                        readonly
                    ></textarea>
                </div>

                <!-- Statistics -->
                <div id="statsSection" class="grid md:grid-cols-3 gap-4">
                    <div class="bg-white bg-opacity-10 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-white" id="wordCount">0</div>
                        <div class="text-white opacity-80">Số từ</div>
                    </div>
                    <div class="bg-white bg-opacity-10 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-white" id="charCount">0</div>
                        <div class="text-white opacity-80">Ký tự</div>
                    </div>
                    <div class="bg-white bg-opacity-10 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-white" id="platformUsed">Auto</div>
                        <div class="text-white opacity-80">Nền tảng</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="text-center mt-8 text-white opacity-60">
            <p>
                <i class="fas fa-heart text-red-400"></i>
                Created by <a href="https://www.facebook.com/duymuoi.team" target="_blank" class="text-white hover:text-blue-300 font-semibold">anhtv@dcme</a> | 
                Hỗ trợ YouTube, TikTok, X (Twitter)
            </p>
        </div>
    </div>

    <script>
        class MultiPlatformTranscriptApp {
            constructor() {
                this.currentTranscript = null;
                this.currentVideoId = null;
                this.selectedPlatform = 'auto';
                this.initializeEventListeners();
                this.selectPlatform('auto'); // Set default
            }

            initializeEventListeners() {
                document.getElementById('processBtn').addEventListener('click', () => this.processVideo());
                document.getElementById('urlInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.processVideo();
                });
                document.getElementById('copyBtn').addEventListener('click', () => this.copyTranscript());
                document.getElementById('downloadBtn').addEventListener('click', () => this.downloadTranscript());
                
                // Auto-detect platform when URL is typed
                document.getElementById('urlInput').addEventListener('input', (e) => {
                    if (this.selectedPlatform === 'auto') {
                        this.detectPlatformFromURL(e.target.value);
                    }
                });
            }

            selectPlatform(platform) {
                this.selectedPlatform = platform;
                
                // Update active state
                document.querySelectorAll('.platform-button').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(`[data-platform="${platform}"]`).classList.add('active');
                
                // Update UI based on platform
                this.updateUIForPlatform(platform);
            }

            updateUIForPlatform(platform) {
                const urlLabel = document.getElementById('urlLabel');
                const urlInput = document.getElementById('urlInput');
                const examples = document.getElementById('platformExamples');
                
                switch(platform) {
                    case 'youtube':
                        urlLabel.textContent = 'YouTube URL hoặc Video ID:';
                        urlInput.placeholder = 'https://www.youtube.com/watch?v=... hoặc dQw4w9WgXcQ';
                        examples.innerHTML = '<div>• Ví dụ: https://www.youtube.com/watch?v=dQw4w9WgXcQ</div><div>• Video ID: dQw4w9WgXcQ</div>';
                        break;
                    case 'tiktok':
                        urlLabel.textContent = 'TikTok Video URL:';
                        urlInput.placeholder = 'https://www.tiktok.com/@username/video/1234567890';
                        examples.innerHTML = '<div>• Ví dụ: https://www.tiktok.com/@username/video/1234567890</div>';
                        break;
                    case 'twitter':
                        urlLabel.textContent = 'X (Twitter) Video URL:';
                        urlInput.placeholder = 'https://twitter.com/username/status/1234567890 hoặc https://x.com/...';
                        examples.innerHTML = '<div>• Ví dụ: https://twitter.com/username/status/1234567890</div><div>• X.com: https://x.com/username/status/1234567890</div>';
                        break;
                    default: // auto
                        urlLabel.textContent = 'URL Video hoặc Video ID:';
                        urlInput.placeholder = 'Nhập URL video từ YouTube, TikTok, X hoặc Video ID...';
                        examples.innerHTML = `
                            <div>• YouTube: https://www.youtube.com/watch?v=dQw4w9WgXcQ</div>
                            <div>• TikTok: https://www.tiktok.com/@username/video/1234567890</div>
                            <div>• X: https://twitter.com/username/status/1234567890</div>
                        `;
                }
            }

            detectPlatformFromURL(url) {
                if (!url) return;
                
                const lowerUrl = url.toLowerCase();
                let detectedPlatform = 'auto';
                
                if (lowerUrl.includes('youtube.com') || lowerUrl.includes('youtu.be')) {
                    detectedPlatform = 'youtube';
                } else if (lowerUrl.includes('tiktok.com')) {
                    detectedPlatform = 'tiktok';
                } else if (lowerUrl.includes('twitter.com') || lowerUrl.includes('x.com')) {
                    detectedPlatform = 'twitter';
                }
                
                // Update UI to show detected platform
                if (detectedPlatform !== 'auto') {
                    const platformBtn = document.querySelector(`[data-platform="${detectedPlatform}"]`);
                    if (platformBtn) {
                        platformBtn.style.background = 'rgba(34, 197, 94, 0.3)';
                        platformBtn.style.borderColor = 'rgba(34, 197, 94, 0.6)';
                        
                        setTimeout(() => {
                            platformBtn.style.background = '';
                            platformBtn.style.borderColor = '';
                        }, 2000);
                    }
                }
            }

            extractVideoInfo(url) {
                // YouTube patterns
                const youtubePatterns = [
                    /(?:https?:\/\/)?(?:www\.)?youtube\.com\/watch\?v=([a-zA-Z0-9_-]+)/,
                    /(?:https?:\/\/)?(?:www\.)?youtu\.be\/([a-zA-Z0-9_-]+)/,
                    /(?:https?:\/\/)?(?:www\.)?youtube\.com\/embed\/([a-zA-Z0-9_-]+)/
                ];

                // Check if it's a YouTube video ID
                if (/^[a-zA-Z0-9_-]{11}$/.test(url)) {
                    return { id: url, platform: 'youtube' };
                }

                // Check YouTube patterns
                for (const pattern of youtubePatterns) {
                    const match = url.match(pattern);
                    if (match) return { id: match[1], platform: 'youtube' };
                }

                // TikTok detection
                if (url.includes('tiktok.com')) {
                    return { id: null, platform: 'tiktok', url: url };
                }

                // Twitter/X detection
                if (url.includes('twitter.com') || url.includes('x.com')) {
                    return { id: null, platform: 'twitter', url: url };
                }

                return { id: null, platform: 'unknown', url: url };
            }

            showStatus(message, type = 'info') {
                const statusSection = document.getElementById('statusSection');
                const statusContent = document.getElementById('statusContent');
                
                let icon = '';
                let bgColor = '';
                
                switch(type) {
                    case 'loading':
                        icon = '<div class="loading-spinner inline-block mr-2"></div>';
                        bgColor = 'bg-blue-500';
                        break;
                    case 'success':
                        icon = '<i class="fas fa-check-circle mr-2"></i>';
                        bgColor = 'bg-green-500';
                        break;
                    case 'error':
                        icon = '<i class="fas fa-exclamation-triangle mr-2"></i>';
                        bgColor = 'bg-red-500';
                        break;
                    default:
                        icon = '<i class="fas fa-info-circle mr-2"></i>';
                        bgColor = 'bg-blue-500';
                }

                statusContent.innerHTML = `${icon}${message}`;
                statusSection.className = `mb-6 p-4 ${bgColor} bg-opacity-20 rounded-lg`;
                statusSection.classList.remove('hidden');
            }

            hideStatus() {
                document.getElementById('statusSection').classList.add('hidden');
            }

            async processVideo() {
                const urlInput = document.getElementById('urlInput').value.trim();
                const languageSelect = document.getElementById('languageSelect').value;
                const includeTimestamps = document.getElementById('includeTimestamps').checked;

                if (!urlInput) {
                    this.showStatus('Vui lòng nhập URL video hoặc Video ID', 'error');
                    return;
                }

                const videoInfo = this.extractVideoInfo(urlInput);
                this.currentVideoId = videoInfo.id || 'unknown';
                document.getElementById('resultsSection').classList.add('hidden');

                try {
                    this.showStatus(`Đang xử lý video từ ${videoInfo.platform.toUpperCase()}...`, 'loading');

                    const response = await fetch('/api/transcript', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            url: urlInput,
                            languages: languageSelect.split(','),
                            include_timestamps: includeTimestamps
                        })
                    });

                    const result = await response.json();

                    if (result.success) {
                        this.currentTranscript = result;
                        this.displayResults(result);
                        this.showStatus(`Xử lý ${result.platform || videoInfo.platform} thành công!`, 'success');
                        setTimeout(() => this.hideStatus(), 3000);
                    } else {
                        this.showStatus(result.error || 'Có lỗi xảy ra', 'error');
                        
                        // Show suggestions if available
                        if (result.suggestions) {
                            setTimeout(() => {
                                const suggestions = result.suggestions.map(s => `• ${s}`).join('\n');
                                this.showStatus(`Gợi ý:\n${suggestions}`, 'info');
                            }, 3000);
                        }
                    }

                } catch (error) {
                    this.showStatus('Lỗi kết nối. Vui lòng thử lại sau.', 'error');
                    console.error('Error:', error);
                }
            }

            displayResults(result) {
                const platformDisplay = result.platform || 'Unknown';
                const apiUsed = result.api_used || 'Supadata';
                
                document.getElementById('videoDetails').innerHTML = `
                    <div class="grid md:grid-cols-3 gap-4">
                        <div><strong>Platform:</strong> ${platformDisplay}</div>
                        <div><strong>Ngôn ngữ:</strong> ${result.language}</div>
                        <div><strong>API:</strong> ${apiUsed}</div>
                    </div>
                `;

                // Handle available languages
                if (result.available_languages && result.available_languages.length > 0) {
                    const languagesList = result.available_languages.map(lang => 
                        `<span class="inline-block bg-white bg-opacity-20 px-2 py-1 rounded mr-2 mb-1">${lang}</span>`
                    ).join('');
                    
                    document.getElementById('languagesList').innerHTML = languagesList;
                    document.getElementById('languagesSection').classList.remove('hidden');
                } else {
                    document.getElementById('languagesSection').classList.add('hidden');
                }

                document.getElementById('transcriptOutput').value = result.text;

                // Update statistics
                document.getElementById('wordCount').textContent = result.word_count || 0;
                document.getElementById('charCount').textContent = result.text.length || 0;
                document.getElementById('platformUsed').textContent = platformDisplay;

                document.getElementById('resultsSection').classList.remove('hidden');
            }

            formatDuration(seconds) {
                const hours = Math.floor(seconds / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                const secs = Math.floor(seconds % 60);

                if (hours > 0) {
                    return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                }
                return `${minutes}:${secs.toString().padStart(2, '0')}`;
            }

            async copyTranscript() {
                const transcript = document.getElementById('transcriptOutput').value;
                if (!transcript) return;

                try {
                    await navigator.clipboard.writeText(transcript);
                    
                    const btn = document.getElementById('copyBtn');
                    const originalText = btn.innerHTML;
                    btn.innerHTML = '<i class="fas fa-check mr-1"></i>Đã copy!';
                    btn.classList.remove('bg-green-600', 'hover:bg-green-700');
                    btn.classList.add('bg-green-800');
                    
                    setTimeout(() => {
                        btn.innerHTML = originalText;
                        btn.classList.remove('bg-green-800');
                        btn.classList.add('bg-green-600', 'hover:bg-green-700');
                    }, 2000);
                } catch (error) {
                    console.error('Copy failed:', error);
                }
            }

            downloadTranscript() {
                const transcript = document.getElementById('transcriptOutput').value;
                if (!transcript) return;

                const includeTimestamps = document.getElementById('includeTimestamps').checked;
                const platform = this.currentTranscript?.platform || 'video';
                let content = transcript;
                let filename = `transcript_${platform}_${this.currentVideoId || 'unknown'}.txt`;

                if (includeTimestamps && this.currentTranscript?.transcript) {
                    content = this.generateSRT(this.currentTranscript.transcript);
                    filename = `transcript_${platform}_${this.currentVideoId || 'unknown'}.srt`;
                }

                const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
            }

            generateSRT(transcript) {
                if (!Array.isArray(transcript)) return '';
                
                return transcript.map((item, index) => {
                    const startTime = this.secondsToSRTTime(item.start || 0);
                    const endTime = this.secondsToSRTTime((item.start || 0) + (item.duration || 3));
                    
                    return `${index + 1}\n${startTime} --> ${endTime}\n${item.text}\n`;
                }).join('\n');
            }

            secondsToSRTTime(seconds) {
                const hours = Math.floor(seconds / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                const secs = Math.floor(seconds % 60);
                const millisecs = Math.floor((seconds % 1) * 1000);
                
                return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')},${millisecs.toString().padStart(3, '0')}`;
            }
        }

        // Global function for platform selection
        function selectPlatform(platform) {
            if (window.app) {
                window.app.selectPlatform(platform);
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            window.app = new MultiPlatformTranscriptApp();
        });
    </script>
</body>
</html>